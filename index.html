<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Snake</title>

<style>
body{
  background:black;
  color:white;
  font-family:Arial;
  margin:0;
  text-align:center;
  overflow:hidden;
}

#menu{
  margin-top:40px;
}

#menu button{
  font-size:20px;
  padding:15px 30px;
  margin:10px;
}

#actions{
  display:none;
  margin:10px;
}

#actions button{
  font-size:16px;
  padding:10px 20px;
}

canvas{
  background:#111;
  display:none;
  touch-action:none;
}
</style>
</head>

<body>

<h2>üçé Apples: <span id="score">0</span></h2>
<h2>üèÜ High Score: <span id="highscore">0</span></h2>

<div id="menu">
  <h2>How are you going to play?</h2>
  <button onclick="startGame('pc')">üñ•Ô∏è PC</button>
  <button onclick="startGame('mobile')">üì± Mobile</button>
</div>

<div id="actions">
  <button onclick="togglePause()">‚è∏Ô∏è Pause</button>
</div>

<canvas id="c" width="400" height="400"></canvas>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");
const scoreEl = document.getElementById("score");
const highscoreEl = document.getElementById("highscore");
const menu = document.getElementById("menu");
const actions = document.getElementById("actions");

const box = 20;
let snake, food, dx, dy, score;
let lastTime = 0;
let speed = 120;
let paused = false;
let mode = "";

// High score
let highscore = localStorage.getItem("snakeHighScore") || 0;
highscoreEl.textContent = highscore;

function resetState(){
  snake = [{x:200,y:200}];
  dx = box;
  dy = 0;
  score = 0;
  scoreEl.textContent = score;
  food = spawnFood();
}

function spawnFood(){
  return {
    x: Math.floor(Math.random()*20)*box,
    y: Math.floor(Math.random()*20)*box
  };
}

/* ---------- START ---------- */
function startGame(type){
  mode = type;
  paused = false;

  menu.style.display = "none";
  actions.style.display = "block";
  c.style.display = "block";

  if(type === "mobile"){
    enterFullscreen();
    resizeCanvasMobile();
  } else {
    c.style.width = "400px";
    c.style.height = "400px";
  }

  resetState();
  requestAnimationFrame(loop);
}

/* ---------- FULLSCREEN AUTO (MOBILE) ---------- */
function enterFullscreen(){
  const el = document.documentElement;
  if(el.requestFullscreen) el.requestFullscreen();
}

/* ---------- PAUSE ---------- */
function togglePause(){
  paused = !paused;
}

/* ---------- CONTROLS ---------- */
document.addEventListener("keydown", e=>{
  if(mode !== "pc" || paused) return;

  if(e.key==="ArrowUp" && dy===0){dx=0;dy=-box;}
  if(e.key==="ArrowDown" && dy===0){dx=0;dy=box;}
  if(e.key==="ArrowLeft" && dx===0){dx=-box;dy=0;}
  if(e.key==="ArrowRight" && dx===0){dx=box;dy=0;}
});

let sx=0, sy=0;

c.addEventListener("touchstart", e=>{
  if(mode!=="mobile"||paused) return;
  sx = e.touches[0].clientX;
  sy = e.touches[0].clientY;
});

c.addEventListener("touchend", e=>{
  if(mode!=="mobile"||paused) return;

  const dxT = e.changedTouches[0].clientX - sx;
  const dyT = e.changedTouches[0].clientY - sy;

  if(Math.abs(dxT)>Math.abs(dyT)){
    if(dxT>30 && dx===0){dx=box;dy=0;}
    if(dxT<-30 && dx===0){dx=-box;dy=0;}
  } else {
    if(dyT>30 && dy===0){dx=0;dy=box;}
    if(dyT<-30 && dy===0){dx=0;dy=-box;}
  }
});

/* ---------- LOOP OPTIMIZADO ---------- */
function loop(time){
  if(paused){
    requestAnimationFrame(loop);
    return;
  }

  if(time - lastTime > speed){
    update();
    draw();
    lastTime = time;
  }

  requestAnimationFrame(loop);
}

function update(){
  const head = {x: snake[0].x + dx, y: snake[0].y + dy};

  if(head.x===food.x && head.y===food.y){
    score++;
    scoreEl.textContent = score;
    food = spawnFood();
  } else {
    snake.pop();
  }

  if(head.x<0||head.y<0||head.x>=400||head.y>=400||
     snake.some(s=>s.x===head.x&&s.y===head.y)){
    gameOver();
    return;
  }

  snake.unshift(head);
}

function draw(){
  ctx.clearRect(0,0,400,400);
  ctx.fillStyle="red";
  ctx.fillRect(food.x,food.y,box,box);
  ctx.fillStyle="lime";
  snake.forEach(s=>ctx.fillRect(s.x,s.y,box,box));
}

function gameOver(){
  alert("Game Over üò¢\nApples eaten: " + score);

  if(score>highscore){
    highscore=score;
    localStorage.setItem("snakeHighScore",highscore);
    highscoreEl.textContent=highscore;
    alert("üéâ New High Score!");
  }

  menu.style.display="block";
  actions.style.display="none";
  c.style.display="none";
  mode="";
}

/* ---------- MOBILE SIZE ---------- */
function resizeCanvasMobile(){
  const size = Math.min(innerWidth, innerHeight);
  c.style.width = size+"px";
  c.style.height = size+"px";
}
</script>

</body>
</html>
