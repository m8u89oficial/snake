<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Snake</title>

<style>
body{
  background:black;
  text-align:center;
  color:white;
  font-family:Arial;
  margin:0;
}

/* start menu */
#menu{
  margin-top:40px;
}

#menu button{
  font-size:20px;
  padding:15px 30px;
  margin:10px;
}

/* action buttons */
#actions{
  margin:10px;
}

#actions button{
  font-size:16px;
  padding:10px 20px;
  margin:5px;
}

/* canvas */
canvas{
  background:#111;
  display:none;
  touch-action:none;
}
</style>
</head>

<body>

<h2>üçé Apples: <span id="score">0</span></h2>
<h2>üèÜ High Score: <span id="highscore">0</span></h2>

<!-- START MENU -->
<div id="menu">
  <h2>How are you going to play?</h2>
  <button onclick="startGame('pc')">üñ•Ô∏è PC</button>
  <button onclick="startGame('mobile')">üì± Mobile</button>
</div>

<!-- ACTION BUTTONS -->
<div id="actions" style="display:none;">
  <button id="pauseBtn" onclick="togglePause()">‚è∏Ô∏è Pause</button>
  <button id="fullscreenBtn" onclick="goFullScreen()" style="display:none;">üî≥ Full Screen</button>
</div>

<canvas id="c" width="400" height="400"></canvas>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");
const scoreEl = document.getElementById("score");
const highscoreEl = document.getElementById("highscore");
const menu = document.getElementById("menu");
const actions = document.getElementById("actions");
const pauseBtn = document.getElementById("pauseBtn");
const fullscreenBtn = document.getElementById("fullscreenBtn");

let box = 20;
let snake = [{x:200,y:200}];
let dx = box;
let dy = 0;
let score = 0;
let interval = null;
let mode = "";
let paused = false;

// high score
let highscore = localStorage.getItem("snakeHighScore") || 0;
highscoreEl.textContent = highscore;

let food = {
  x: Math.floor(Math.random()*20)*box,
  y: Math.floor(Math.random()*20)*box
};

/* ---------- KEYBOARD (PC) ---------- */
document.addEventListener("keydown", e=>{
  if(mode === ""){
    return;
  }

  if(e.key === "p" || e.key === "P"){
    togglePause();
  }

  if(mode !== "pc" || paused) return;

  if(e.key==="ArrowUp") changeDirection("UP");
  if(e.key==="ArrowDown") changeDirection("DOWN");
  if(e.key==="ArrowLeft") changeDirection("LEFT");
  if(e.key==="ArrowRight") changeDirection("RIGHT");
});

/* ---------- SWIPE (MOBILE) ---------- */
let touchStartX = 0;
let touchStartY = 0;

c.addEventListener("touchstart", e=>{
  if(mode !== "mobile" || paused) return;
  const t = e.touches[0];
  touchStartX = t.clientX;
  touchStartY = t.clientY;
});

c.addEventListener("touchend", e=>{
  if(mode !== "mobile" || paused) return;

  const t = e.changedTouches[0];
  const dxTouch = t.clientX - touchStartX;
  const dyTouch = t.clientY - touchStartY;

  if(Math.abs(dxTouch) > Math.abs(dyTouch)){
    if(dxTouch > 30) changeDirection("RIGHT");
    if(dxTouch < -30) changeDirection("LEFT");
  } else {
    if(dyTouch > 30) changeDirection("DOWN");
    if(dyTouch < -30) changeDirection("UP");
  }
});

/* ---------- START GAME ---------- */
function startGame(type){
  mode = type;
  paused = false;
  pauseBtn.textContent = "‚è∏Ô∏è Pause";

  menu.style.display = "none";
  actions.style.display = "block";
  c.style.display = "block";

  if(type === "mobile"){
    fullscreenBtn.style.display = "inline-block";
    resizeCanvasMobile();
    window.addEventListener("resize", resizeCanvasMobile);
  } else {
    fullscreenBtn.style.display = "none";
    c.style.width = "400px";
    c.style.height = "400px";
  }

  if(interval) clearInterval(interval);
  interval = setInterval(game,150);
}

/* ---------- PAUSE ---------- */
function togglePause(){
  if(mode === "") return;

  paused = !paused;

  if(paused){
    clearInterval(interval);
    pauseBtn.textContent = "‚ñ∂Ô∏è Resume";
  } else {
    interval = setInterval(game,150);
    pauseBtn.textContent = "‚è∏Ô∏è Pause";
  }
}

/* ---------- FULL SCREEN (MOBILE) ---------- */
function goFullScreen(){
  if(document.documentElement.requestFullscreen){
    document.documentElement.requestFullscreen();
  }
}

/* ---------- RESIZE CANVAS (MOBILE) ---------- */
function resizeCanvasMobile(){
  const size = Math.min(window.innerWidth, window.innerHeight) - 20;
  c.style.width = size + "px";
  c.style.height = size + "px";
}

/* ---------- GAME LOGIC ---------- */
function changeDirection(dir){
  if(dir==="UP" && dy===0){dx=0;dy=-box;}
  if(dir==="DOWN" && dy===0){dx=0;dy=box;}
  if(dir==="LEFT" && dx===0){dx=-box;dy=0;}
  if(dir==="RIGHT" && dx===0){dx=box;dy=0;}
}

function game(){
  ctx.clearRect(0,0,400,400);

  ctx.fillStyle="red";
  ctx.fillRect(food.x,food.y,box,box);

  ctx.fillStyle="lime";
  snake.forEach(s=>ctx.fillRect(s.x,s.y,box,box));

  let head={x:snake[0].x+dx,y:snake[0].y+dy};

  if(head.x===food.x && head.y===food.y){
    score++;
    scoreEl.textContent = score;
    food={
      x:Math.floor(Math.random()*20)*box,
      y:Math.floor(Math.random()*20)*box
    };
  } else {
    snake.pop();
  }

  if(head.x<0||head.y<0||head.x>=400||head.y>=400||
     snake.some(s=>s.x===head.x&&s.y===head.y)){
    alert("Game Over üò¢\nApples eaten: " + score);

    if(score > highscore){
      highscore = score;
      localStorage.setItem("snakeHighScore", highscore);
      highscoreEl.textContent = highscore;
      alert("üéâ New High Score!");
    }

    resetGame();
    return;
  }

  snake.unshift(head);
}

function resetGame(){
  clearInterval(interval);
  mode = "";
  paused = false;

  snake=[{x:200,y:200}];
  dx=box; dy=0;
  score=0;
  scoreEl.textContent = score;

  c.style.display="none";
  actions.style.display="none";
  fullscreenBtn.style.display="none";
  menu.style.display="block";
}
</script>

</body>
</html>
